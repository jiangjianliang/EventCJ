CompilationUnit(
  Some(PackageDec([], PackageName([Id("main")])))
, []
, [ Direction(
      Id("SwitchPositionDevice")
    , [ EventDecl(
          Id("GPSEvent")
        , [ Param(
              []
            , ClassOrInterfaceType(TypeName(Id("Navigation")), None())
            , Id("n")
            )
          , Param([], Int(), Id("s"))
          ]
        , AndComp(
            ActionSelector(
              AfterTiming()
            , Call(
                MethodPattern(
                  AnnoPattern([])
                , ModPattern([])
                , Void()
                , MemberName(RefTypePattern(NamePattern("Navigation")), "onStatusChanged")
                , [RefTypePattern(NamePattern("s"))]
                , None()
                )
              )
            )
          , TargetSelector(ClassOrInterfaceType(TypeName(Id("n")), None()))
          )
        , Some(SendTo(ExprName(Id("n"))))
        )
      , EventDecl(
          Id("WifiEvent")
        , [ Param(
              []
            , ClassOrInterfaceType(TypeName(Id("Navigation")), None())
            , Id("n")
            )
          , Param([], Int(), Id("s"))
          ]
        , AndComp(
            ActionSelector(
              AfterTiming()
            , Call(
                MethodPattern(
                  AnnoPattern([])
                , ModPattern([])
                , Void()
                , MemberName(RefTypePattern(NamePattern("Navigation")), "onStatusChanged")
                , [RefTypePattern(NamePattern("s"))]
                , None()
                )
              )
            )
          , TargetSelector(ClassOrInterfaceType(TypeName(Id("n")), None()))
          )
        , Some(SendTo(ExprName(Id("n"))))
        )
      , EventDecl(
          Id("Boarding")
        , []
        , ActionSelector(
            AfterTiming()
          , Call(
              MethodPattern(
                AnnoPattern([])
              , ModPattern([])
              , Void()
              , MemberName(RefTypePattern(NamePattern("*")), "cabinModeEntered")
              , []
              , None()
              )
            )
          )
        , None()
        )
      , EventDecl(
          Id("Arriving")
        , []
        , ActionSelector(
            AfterTiming()
          , Call(
              MethodPattern(
                AnnoPattern([])
              , ModPattern([])
              , Void()
              , MemberName(RefTypePattern(NamePattern("*")), "cabinModeExit")
              , []
              , None()
              )
            )
          )
        , None()
        )
      , TransitionRuleDecl(
          Id("GPSEvent")
        , []
        , TransitionRuleComposition(
            SwitchLayer(Id("WifiNavi"), Id("GPSNavi"))
          , ActivateLayer(IfNotActive(Id("onBoard")), Id("GPSNavi"))
          )
        )
      , TransitionRuleDecl(
          Id("WifiEvent")
        , []
        , TransitionRuleComposition(
            SwitchLayer(Id("GPSNavi"), Id("WifiNavi"))
          , ActivateLayer(IfNotActive(Id("onBoard")), Id("WifiNavi"))
          )
        )
      , TransitionRuleDecl(Id("Boarding"), [], SwitchLayer(AnnonLayer(), Id("OnBoard")))
      , TransitionRuleDecl(Id("Arriving"), [], SwitchLayer(Id("OnBoard"), NoLayer()))
      ]
    )
  , ClassDec(
      ClassDecHead(
        []
      , Id("Navigation")
      , None()
      , Some(SuperDec(ClassType(TypeName(Id("MapActivity")), None())))
      , Some(
          ImplementsDec(
            [ InterfaceType(TypeName(Id("Runnable")), None())
            , InterfaceType(TypeName(Id("LocationListener")), None())
            ]
          )
        )
      )
    , ClassBody(
        [ FieldDec(
            []
          , ClassOrInterfaceType(TypeName(Id("MapView")), None())
          , [VarDec(Id("mapView"))]
          )
        , FieldDec(
            []
          , ClassOrInterfaceType(TypeName(Id("MyLocationOverlay")), None())
          , [VarDec(Id("overlay"))]
          )
        , FieldDec(
            []
          , ClassOrInterfaceType(TypeName(Id("WifiManager")), None())
          , [VarDec(Id("wifiManager"))]
          )
        , FieldDec(
            []
          , ClassOrInterfaceType(TypeName(Id("BuildingGuide")), None())
          , [VarDec(Id("buildingGuide"))]
          )
        , MethodDec(
            MethodDecHead([], None(), Void(), Id("onStatusChanged"), [], None())
          , Block([])
          )
        , MethodDec(
            MethodDecHead([], None(), Void(), Id("run"), [], None())
          , Block([])
          )
        , MethodDec(
            MethodDecHead(
              []
            , None()
            , Void()
            , Id("onCreate")
            , [Param(
                 []
               , ClassOrInterfaceType(TypeName(Id("Bundle")), None())
               , Id("status")
               )]
            , None()
            )
          , Block(
              [ ExprStm(
                  Invoke(
                    Method(MethodName(AmbName(Id("overlay")), Id("runOnFirstFix")))
                  , [This()]
                  )
                )
              ]
            )
          )
        , Layer(
            Id("GPSNavi")
          , [ Activation(
                Block(
                  [ ExprStm(
                      Invoke(
                        Method(MethodName(AmbName(Id("overlay")), Id("onProviderEnabled")))
                      , [Lit(String([Chars("gps")]))]
                      )
                    )
                  ]
                )
              )
            , Deactivation(
                Block(
                  [ ExprStm(
                      Invoke(
                        Method(MethodName(AmbName(Id("overlay")), Id("onProviderDisabled")))
                      , [Lit(String([Chars("gps")]))]
                      )
                    )
                  ]
                )
              )
            , PartialMethodDec(
                PartialMethodHead(None(), AfterTiming(), Void(), Id("run"), [], None())
              , Block(
                  [ LocalVarDecStm(
                      LocalVarDec(
                        []
                      , ClassOrInterfaceType(TypeName(Id("Location")), None())
                      , [ VarDec(
                            Id("loc")
                          , Invoke(
                              Method(MethodName(AmbName(Id("overlay")), Id("getMyLocation")))
                            , []
                            )
                          )
                        ]
                      )
                    )
                  , ExprStm(
                      Invoke(
                        Method(
                          Invoke(
                            Method(MethodName(AmbName(Id("mapView")), Id("getController")))
                          , []
                          )
                        , None()
                        , Id("animateTo")
                        )
                      , [ExprName(Id("loc"))]
                      )
                    )
                  ]
                )
              )
            ]
          )
        , Layer(
            Id("WifiNavi")
          , [ Activation(
                Block(
                  [ ExprStm(
                      Invoke(
                        Method(MethodName(AmbName(Id("overlay")), Id("onProviderEnabled")))
                      , [Lit(String([Chars("Network")]))]
                      )
                    )
                  , ExprStm(
                      Invoke(
                        Method(MethodName(AmbName(Id("wifiManager")), Id("setWifiEnable")))
                      , [Lit(Bool(True()))]
                      )
                    )
                  ]
                )
              )
            , Deactivation(
                Block(
                  [ ExprStm(
                      Invoke(
                        Method(MethodName(AmbName(Id("overlay")), Id("onProviderDisabled")))
                      , [Lit(String([Chars("Network")]))]
                      )
                    )
                  , ExprStm(
                      Invoke(
                        Method(MethodName(AmbName(Id("wifiManager")), Id("setWifiEnable")))
                      , [Lit(Bool(False()))]
                      )
                    )
                  ]
                )
              )
            , PartialMethodDec(
                PartialMethodHead(None(), AfterTiming(), Void(), Id("run"), [], None())
              , Block(
                  [ LocalVarDecStm(
                      LocalVarDec(
                        []
                      , ClassOrInterfaceType(TypeName(Id("Location")), None())
                      , [ VarDec(
                            Id("loc")
                          , Invoke(
                              Method(MethodName(AmbName(Id("overlay")), Id("getMyLocation")))
                            , []
                            )
                          )
                        ]
                      )
                    )
                  , ExprStm(
                      Invoke(
                        Method(MethodName(AmbName(Id("buildingGuide")), Id("updateFloorPlan")))
                      , [ExprName(Id("loc"))]
                      )
                    )
                  ]
                )
              )
            ]
          )
        ]
      )
    )
  ]
)